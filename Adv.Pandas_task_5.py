# -*- coding: utf-8 -*-
"""task-21.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/13oB3uvD1vpETCO7ZH8jjbyeA_Fb0NzvN
"""

import pandas as pd

"""###`Q-1:` You are given a Multi index DataFrame. You task is to swap level-0 index with level-0 column.
* Change Branch -> ('cse', 'ece') as columns at level-0 and ('delhi'	'mumbai') as level-0 Index
* And Sort on row index level-0
"""

# Given Code Snippets
index_val = [('cse',2019),('cse',2020),('cse',2021),('cse',2022),('ece',2019),('ece',2020),('ece',2021),('ece',2022)]
multiindex = pd.MultiIndex.from_tuples(index_val)
df = pd.DataFrame(
    [
        [1,2,0,0],
        [3,4,0,0],
        [5,6,0,0],
        [7,8,0,0],
        [9,10,0,0],
        [11,12,0,0],
        [13,14,0,0],
        [15,16,0,0],
    ],
    index = multiindex,
    columns = pd.MultiIndex.from_product([['delhi','mumbai'],['avg_package','students']])
)

df

df.unstack(level=0).stack(level=0).swaplevel().swaplevel(axis=1).sort_index(level=0)

"""###`Q-2:` Covid Cases Data Set Problem
 Make a DataFrame Using both Covid Dataset. With Country name as Level-0 and Provinance/State as Level-1 Index and date, No of cases and No of Deaths as Columns.
"""

confirm = pd.read_csv('https://docs.google.com/spreadsheets/d/e/2PACX-1vTmqT3kxd0i0RUFiEnwA1Hboiunv28MeNTatZsIEqlPPB7mHrl0ttJL7utZ23_1s5FW8ZjODmB8jHIi/pub?gid=2142019845&single=true&output=csv')

deaths = pd.read_csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQn4nLCKIVZMw4e89YeRqgKaSAAwRFaZ6ILMW_FUejZ2tkv3Np1f9gD4QOl3ASHeLzWjOjfmLDKcCOF/pub?gid=212966958&single=true&output=csv")

confirmed = confirm.melt(id_vars=['Province/State','Country/Region','Lat','Long'], var_name='date', value_name='confirmed_cases')
death_ = deaths.melt(id_vars=['Province/State','Country/Region','Lat','Long'], var_name='date', value_name='death_cases')

df = confirmed.merge(death_, on=['Province/State','Country/Region','Lat','Long','date']).drop(['Lat','Long'],axis=1).set_index(['Province/State','Country/Region']).swaplevel()

"""###`Q-3:` Show Country with Heighest death percent out of confirmed Cases."""

round(df.groupby('Country/Region')['death_cases'].sum()/df.groupby('Country/Region')['confirmed_cases'].sum()*100,2)

"""### `Q-4` : Make a dataframe for India from Covid Data with one extra column representing no of new cases.

* Just for Assumption "No of new cases" will be equal to difference of "no of cases" with previous day.
* First day new cases will be NaN or equal to no of cases

Say on 12/30/22 No of cases is - 44679608	and a day previous (12/29/22) no of cases is - 44679382.

Then for 12/30/22 -> No of New Cases  = 44679608 - 44679382 =

Note:- Try using shift Function

Try using the shift function

```
s = pd.Series([1,2,3,4,5,6])
s #-> [1,2,3,4,5,6]
s.shift(1) #-> [NaN, 1,2,3,4,5]
s.shift(-1) #-> [2,3,4,5,6, NaN]
```
"""

df1 = df.reset_index()
ind = df1[df1['Country/Region']=='India']
ind['date'] = pd.to_datetime(ind['date'])
ind['new cases'] = ind['confirmed_cases']-ind['confirmed_cases'].shift(1)
ind

"""### `Q-5:` Read the Dataset using the below given link and create a multi-index dataframe using the columns "Country" and "City/Town".

This dataset is about the most polluted cities in the world. You can get details from [here](https://www.kaggle.com/datasets/rajkumarpandey02/worlds-most-air-polluted-countries-cities).

**Dataset link:** https://tinyurl.com/2fe6vz4u Directly use this link to read.

**Task:**
1. Find out the name of the city of India which is most poluted based on PM10.
2. Find out the name of the city of India which has minumum pollution level based on PM10.
3. Do same operations (like 1 and 2) with the country China.
4. Make a pie chart based on the column "PM10" of the country Poland.
5. Make a bar chart based on the columns "PM2.5" and "PM10" of the countries Israel and Qatar.
6. Convert this MultiIndex DataFrame to Series by retaining the informations.
"""

##1
df = pd.read_csv('https://tinyurl.com/2fe6vz4u')
ind = df[df['Country']=='India']
ind.groupby('City/Town')['PM10'].max().sort_values(ascending=False).head(1)

##2
ind.groupby('City/Town')['PM10'].min().sort_values().head(1)

##3
chi = df[df['Country']=='China']
chi.groupby('City/Town')['PM10'].max().sort_values(ascending=False).head(1)

##3
chi.groupby('City/Town')['PM10'].min().sort_values().head(1)

##4
pol = df[df['Country']=='Poland']
pol['PM10'].plot(kind='pie', labels = pol['City/Town'], autopct = '%1.1f%%')

##5Make a bar chart based on the columns "PM2.5" and "PM10" of the countries Israel and Qatar.
data = df[(df['Country']=='Israel')|(df['Country']=='Qatar')]
data.set_index(['Country','City/Town'])[['PM2.5','PM10']].plot(kind='bar')

##6

##Convert this MultiIndex DataFrame to Series by retaining the informations.
d = df.set_index(['Country','City/Town'])

d.stack()

